# Compact — T-20251212-act-006-format-hints

## 1) Scope 对齐（来自 record.json）
- Subtask: `T-20251212-act-006-format-hints`（补齐视频格式支持检测与不支持提示策略）
- Priority/Lane: `P1` / `next`
- Depends on:
  - `T-20251212-act-006-video-overlay-ui`
- Acceptance:
  - 基于 canPlayType/探测策略判断不可播放格式
  - 不可播放时展示明确提示（转码建议/外部播放器打开）
  - 文档列出已验证的支持格式范围

## 2) Interface / 行为变更（影响下游对接）
- Video Overlay（`frontend/spa/app.js`）：
  - 打开视频时先用 `HTMLVideoElement.canPlayType(...)` 对扩展名对应的 MIME candidates 做预判；若全部返回空串，则提前展示“不支持/大概率无法播放”的提示。
  - 监听 `video.error`（`MEDIA_ERR_SRC_NOT_SUPPORTED` / `MEDIA_ERR_DECODE` 等）作为兜底：实际加载失败时展示同一提示。
  - 提示框提供可操作入口：新标签打开、下载文件、复制媒体 URL（便于外部播放器打开网络串流）、复制 ffmpeg 转码命令。
- 文档（`doc/formats/video-playback.md`）：
  - 说明浏览器播放能力的约束、检测策略、以及推荐转码目标格式与命令示例。

## 3) 已确认事实（代码 + 自测覆盖）
- 自测命令：`python3 -m unittest -q`（见本轮变更后续执行结果）

## 4) 实现事实快照（实现要点）
- `frontend/spa/app.js`
  - `createVideoOverlay()` 增加 `.overlay__notice` 提示框与 canPlayType 探测逻辑；在不支持/解码失败时渲染提示与操作按钮。
- `frontend/spa/styles.css`
  - 新增 `.overlay__notice*` 样式（提示框布局、按钮区、mono 详情区）。
- `doc/formats/video-playback.md`
  - 输出“扩展名 → MIME candidates”表与转码/外部打开指引。

## 5) 显式限制 / 风险 / TODO（未在本 Subtask 内解决）
- `canPlayType` 只能做“类型/codec 可能性”探测，无法仅凭扩展名准确判断封装内实际编码；最终仍以运行时加载结果为准。
- 若未来需要更精确的“编码级”提示（例如识别 HEVC/H.265），需要引入 `ffprobe`/后端 metadata API 或在索引阶段提取媒体信息。

