# Compact — T-20251212-act-005-image-scaling

## 1) Scope 对齐（来自 record.json）
- Task: `T-20251212-act-005-image-scaling`（按决策实现图片等比缩放与“黑边”处理）
- Priority/Lane: `P0` / `now`
- Depends on:
  - `T-20251212-act-005-image-overlay-ui`
  - `T-20251212-act-012-clarify-rules`
- Acceptance:
  - 图片保持宽高比，前景最大等比缩放至可用区域，不拉伸不裁切
  - 前景始终完整可见（contain），尽可能占满网页
  - 剩余区域用同一媒体做背景填充消除黑边，并提供不同宽高比示例验收

## 2) 行为变更（前端 Overlay）
- Overlay 图片舞台区引入“同图背景填充”：
  - 前景：`object-fit: contain`，始终完整可见，不裁切/拉伸。
  - 背景：同一图片作为 `background-image`，`cover` 填充 + `blur` 处理，用于消除宽高比不一致导致的黑边观感。

## 3) 实现事实快照（实现要点）
- `frontend/spa/app.js`
  - `createImageOverlay()` 的 `overlay__stage` 增加 `overlay__bg` 背景层。
  - 切图时使用同一 `src` 同步更新前景 `<img>` 与背景层 `background-image`；无图/关闭/加载失败时清空背景。
- `frontend/spa/styles.css`
  - 新增 `.overlay__bg`：`background-size: cover` + `filter: blur(...)` + 轻度遮罩。
  - 调整 `.overlay__img`：`width/height: 100%` + `object-fit: contain`，保证“最大等比缩放、完整可见”。

## 4) 验收示例（宽高比差异）
- 横图（16:9）、竖图（9:16）、方图（1:1）、超宽图（21:9）在 Overlay 中：
  - 前景始终完整可见（contain），不裁切、不拉伸。
  - 周边不再出现纯黑边；空白区域由同图背景填充（模糊处理）覆盖。

## 5) 限制 / TODO
- 当前 Overlay 仍使用 `/api/thumb` 作为查看源（后续如需“原图级”查看，可新增原图/大图接口并在 Overlay 切换到更高分辨率来源）。
