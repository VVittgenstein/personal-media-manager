# 第三方依赖与许可证清单（草案）

> 目的：提前锁定第三方依赖策略与许可证边界，避免未来对外分发时产生意外义务；本文不构成法律意见。

更新时间：2025-12-13

## 1. 结论（可执行）

- 本项目源代码许可证：MIT（见仓库根目录 `LICENSE`）。
- 当前代码（截至本文更新时间）：后端主要使用 Python 标准库；图片缩略图功能依赖 Pillow（见 `backend/requirements.txt`）；仓库内仍未引入任何 npm 依赖。
- FFmpeg 集成结论（Windows）：**采用“外部可执行文件调用（CLI）”方式，默认不随包分发**。用户自行安装/提供 `ffmpeg.exe` 与 `ffprobe.exe`，程序运行时检测可用性并给出配置指引。
- 若未来需要随包分发 FFmpeg：优先选择 **LGPL 构建** 并按其许可证要求随附许可证文本、源码/源码获取方式与构建信息；避免通过链接方式集成 `libav*`。

## 2. 主要依赖与许可证类型（当前 + 计划/可选）

| 组件 | 用途 | 引入方式 | 是否计划随包分发 | 许可证（类型） | 合规要点/备注 |
|---|---|---:|---:|---|---|
| Python（运行时） | 后端运行环境 | 用户安装/系统提供 | 否（默认） | PSF License（PSF-2.0，宽松） | 若未来打包分发 Python 运行时（如打包成 exe），需随附 Python 许可证与对应声明。 |
| FFmpeg（`ffmpeg`/`ffprobe`） | 视频抽帧、生成 2×2 预览图、（可选）读取媒体信息 | 外部 CLI 进程调用 | 否（默认） | LGPL-2.1-or-later / GPL-2.0-or-later（取决于构建与启用组件） | 不以链接库方式集成；默认不分发其二进制。若分发需满足 FFmpeg 对应许可证义务（见第 3 节）。 |
| Pillow（图片缩略图） | 图片缩略图生成/压缩 | Python 包（pip） | 待定 | PIL / HPND（宽松） | 已用于图片缩略图（见 `backend/requirements.txt`）；需在 `NOTICE` 中登记并保留其许可证/声明（如有）。 |
| Video.js（可选，前端播放器增强） | 统一视频控件/兼容性增强 | 前端依赖 | 待定 | Apache-2.0（宽松） | 若随产品分发其代码，需保留 Apache-2.0 许可证及其 `NOTICE`（如上游提供）。 |
| SQLite（可选，索引/日志持久化） | 索引/日志数据库 | 系统库或内置组件 | 待定 | Public Domain（SQLite） | 若以 Python `sqlite3` 使用，通常随 Python 发行；若单独分发需确认具体打包方式。 |

> 说明：此表只覆盖“主要依赖”。后续引入任何前端组件库、图标/字体、打包工具（如 PyInstaller/Nuitka）时，需补充其许可证并更新 `NOTICE`。

## 3. FFmpeg（Windows）集成方式与分发注意事项（结论）

### 3.1 默认策略（推荐）：用户自装/自提供 FFmpeg

- 程序仅通过命令行调用 `ffmpeg.exe`/`ffprobe.exe`，不在仓库或发行包中包含 FFmpeg 二进制文件。
- 推荐约定：用户将 FFmpeg 安装路径加入 `PATH`，或在配置中显式指定可执行文件路径。
- 运行时行为：检测不到 FFmpeg 时，相关功能（视频缩略图/抽帧）返回明确错误并提供安装/配置指引。

Windows 侧最小可操作指引（示例）：

- 下载并解压一个包含 `ffmpeg.exe` 与 `ffprobe.exe` 的 FFmpeg Windows 构建。
- 将其 `bin` 目录加入系统 `PATH`（例如 `C:\\tools\\ffmpeg\\bin`）。
- 在终端验证：`ffmpeg -version` 与 `ffprobe -version` 可正常输出。

这样做的收益：

- 明确规避“分发 FFmpeg 二进制文件”所带来的许可证随附、源码提供等发行义务工作量；
- 由于不链接 `libav*`，许可证的 copyleft 传播风险显著降低（仍需遵守 FFmpeg 本身的分发规则，若你选择分发它）。

### 3.2 若必须随包分发 FFmpeg（二选一建议）

1) **优先选择 LGPL 构建（推荐）**

- 选择明确标注为 LGPL 的构建（避免启用 GPL 组件，如 `--enable-gpl`，以及任何标注 nonfree 的编解码库）。
- 在发行包中随附：FFmpeg 对应许可证文本、构建信息，以及按许可证要求提供的源码/源码获取方式。

2) **仅在能承担义务时使用 GPL 构建**

- GPL 构建通常意味着 FFmpeg 本体按 GPL 分发；你必须为 FFmpeg 本体提供 GPL 要求的合规材料（许可证文本、源码等）。
- 依然建议保持“外部进程调用”，避免链接 `libav*`；本项目自身仍可保持 MIT，但需确保对 FFmpeg 的分发合规到位。

> 实操建议：无论 LGPL/GPL 构建，都把 FFmpeg 当作“独立第三方组件”对待（单独目录、单独 LICENSE/NOTICE 归档），并在 `NOTICE` 中明确列出来源与许可证。

## 4. LICENSE / NOTICE（草案约定）

- `LICENSE`：继续使用 MIT（当前已存在）。
- `NOTICE`：用于记录本项目分发包中包含/引用的第三方组件与归属信息（本仓库提供草案，后续引入依赖时持续更新）。
